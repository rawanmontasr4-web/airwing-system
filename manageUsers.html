<!DOCTYPE html>
<html>
<head>
  <title>Manage Users - SkyWing Airlines</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#e7f0ff; padding:20px; }
    .navbar {
      display:flex; align-items:center; gap:15px; background:#1d70ff; padding:10px 20px; border-radius:0 0 15px 15px; color:white;
    }
    .navbar .logo { width:50px; height:50px; object-fit:contain; }
    .navbar .company-name { font-weight:bold; font-size:20px; }
    .navbar a { color:white; text-decoration:none; margin-left:15px; padding:5px 10px; border-radius:5px; }
    .navbar a.active, .navbar a:hover { background:#004080; }

    h1 { color:#004080; text-align:center; margin:20px 0; }

    .table-container { display:flex; gap:30px; flex-wrap:wrap; }
    table { border-collapse:collapse; background:white; border-radius:10px; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,0.2); width:60%; }
    th, td { padding:12px; text-align:center; border-bottom:1px solid #ccc; }
    th { background:#004080; color:white; cursor:pointer; }
    tr:hover { background:#f0f6ff; }
    button { padding:6px 12px; border:none; border-radius:5px; cursor:pointer; color:white; }
    .edit-btn { background:#43a047; }
    .delete-btn { background:#e53935; }

    /* Modal */
    .modal {
      display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6);
      justify-content:center; align-items:center;
    }
    .modal-content {
      background:white; padding:20px; border-radius:10px; width:350px; box-shadow:0 8px 20px rgba(0,0,0,0.3);
    }
    .modal-content h3 { text-align:center; margin-bottom:15px; color:#004080; }
    .modal-content label { display:block; margin:8px 0 4px; }
    .modal-content input, .modal-content select { width:100%; padding:8px; margin-bottom:10px; border-radius:5px; border:1px solid #ccc; }
    .modal-content button { width:48%; margin-right:4%; }
    .modal-content button:last-child { margin-right:0; }

    .chart-container { width:35%; height:300px; background:white; border-radius:10px; padding:15px; box-shadow:0 4px 15px rgba(0,0,0,0.2); }
    .chart-container canvas { width:100% !important; height:250px !important; }
  </style>
</head>
<body>

  <div class="navbar">
    <img src="AirWing logo.png" class="logo"/>
    <span class="company-name">SkyWing Airlines</span>
    <a href="adminDashboard.html">Dashboard</a>
    <a href="manageUsers.html" class="active">Manage Users</a>
    <a href="adminLogin.html">Logout</a>
  </div>

  <h1>Manage Users</h1>

  <div class="table-container">
    <table id="usersTable">
      <thead>
        <tr>
          <th>User ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="chart-container">
      <h3 style="text-align:center; color:#004080;">User Activity</h3>
      <canvas id="activityChart"></canvas>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <h3>Edit User</h3>
      <label for="editName">Name</label>
      <input type="text" id="editName">
      <label for="editEmail">Email</label>
      <input type="email" id="editEmail">
      <label for="editRole">Role</label>
      <select id="editRole">
        <option>Admin</option>
        <option>Staff</option>
      </select>
      <button class="edit-btn" onclick="saveUser()">Save</button>
      <button class="delete-btn" onclick="closeModal()">Cancel</button>
    </div>
  </div>

  <script>
    let users = [
      {id:"A101", name:"Nouran Sallam", email:"nouransallam@gmail.com", role:"Admin", edits:5},
      {id:"A102", name:"Rodina Arafat", email:"rodinaarafat@gmail.com", role:"Admin", edits:3},
      {id:"A103", name:"Kenzy Atef", email:"kenzyatef@gmail.com", role:"Admin", edits:7},
      {id:"A104", name:"Tasneem Wael", email:"tasneemwael@gmail.com", role:"Admin", edits:2}
    ];

    const usersTableBody = document.querySelector("#usersTable tbody");
    let currentEditIndex = null;

    function renderTable(){
      usersTableBody.innerHTML = "";
      users.forEach((u,index)=>{
        const row = usersTableBody.insertRow();
        row.insertCell(0).innerText = u.id;
        row.insertCell(1).innerText = u.name;
        row.insertCell(2).innerText = u.email;
        row.insertCell(3).innerText = u.role;
        const actions = row.insertCell(4);
        actions.innerHTML = `<button class="edit-btn" onclick="openEditModal(${index})">Edit</button>
                             <button class="delete-btn" onclick="deleteUser(${index})">Delete</button>`;
      });
      updateChart();
    }

    function openEditModal(index){
      currentEditIndex = index;
      document.getElementById("editName").value = users[index].name;
      document.getElementById("editEmail").value = users[index].email;
      document.getElementById("editRole").value = users[index].role;
      document.getElementById("editModal").style.display = "flex";
    }

    function closeModal(){
      document.getElementById("editModal").style.display = "none";
    }

    function saveUser(){
      users[currentEditIndex].name = document.getElementById("editName").value;
      users[currentEditIndex].email = document.getElementById("editEmail").value;
      users[currentEditIndex].role = document.getElementById("editRole").value;
      users[currentEditIndex].edits +=1; // Count edits
      renderTable();
      closeModal();
    }

    function deleteUser(index){
      if(confirm("Are you sure you want to delete this user?")){
        users.splice(index,1);
        renderTable();
      }
    }

    // ---------------- Chart ----------------
    let activityChart;
    function updateChart(){
      const ctx = document.getElementById('activityChart').getContext('2d');
      const labels = users.map(u => u.name);
      const data = users.map(u => u.edits);

      if(activityChart) activityChart.destroy();

      activityChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Number of Edits',
            data: data,
            backgroundColor: ['#4facfe','#00f2fe','#43e97b','#f093fb']
          }]
        },
        options:{
          responsive:true,
          plugins:{
            legend:{display:false},
            tooltip:{enabled:true}
          },
          scales:{
            y:{beginAtZero:true, title:{display:true, text:'Edits'}}
          }
        }
      });
    }

    // Initial render
    renderTable();
  </script>
</body>
</html>
